From dbd0111574eb16b44575f5a59301b8bf62333c33 Mon Sep 17 00:00:00 2001
From: ci7lus <7887955+ci7lus@users.noreply.github.com>
Date: Thu, 5 Feb 2026 02:03:29 +0900
Subject: [PATCH] =?UTF-8?q?fix:=20TS=E3=83=87=E3=83=9E=E3=83=AB=E3=83=81?=
 =?UTF-8?q?=E3=83=97=E3=83=AC=E3=82=AF=E3=82=B5=E3=81=8C=E9=AB=98=E9=80=9F?=
 =?UTF-8?q?=E3=82=B7=E3=83=BC=E3=82=AF=E3=81=A7=E3=81=8D=E3=81=AA=E3=81=84?=
 =?UTF-8?q?=E5=A0=B4=E5=90=88=E3=81=AB=E3=83=97=E3=83=AC=E3=82=A4=E3=83=A4?=
 =?UTF-8?q?=E3=83=BC=E3=81=AE=E4=BD=8D=E7=BD=AE=E8=A8=88=E7=AE=97=E3=82=92?=
 =?UTF-8?q?=E3=82=B9=E3=82=AD=E3=83=83=E3=83=97=E3=81=99=E3=82=8B=E3=82=88?=
 =?UTF-8?q?=E3=81=86=E4=BF=AE=E6=AD=A3?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/player/timer.c | 22 +++++++++++++++++++++-
 1 file changed, 21 insertions(+), 1 deletion(-)

diff --git a/src/player/timer.c b/src/player/timer.c
index 7448ac1b65..9bd010f446 100644
--- a/src/player/timer.c
+++ b/src/player/timer.c
@@ -364,7 +364,27 @@ vlc_player_UpdateTimerSource(vlc_player_t *player,
     else
         source->point.system_date = system_date;

-    if (source->point.length != VLC_TICK_INVALID && !source->point.live)
+    struct vlc_player_input *input = player->input;
+    bool trust_demux_pos = false;
+
+    if (input && input->thread)
+    {
+        input_thread_private_t *priv = input_priv(input->thread);
+        if (priv->master && priv->master->p_demux &&
+            priv->master->p_demux->psz_name &&
+            strcmp(priv->master->p_demux->psz_name, "ts") == 0)
+        {
+            bool stream_can_fastseek = false;
+            if (priv->master->p_demux->s)
+                vlc_stream_Control(priv->master->p_demux->s, STREAM_CAN_FASTSEEK,
+                                   &stream_can_fastseek);
+
+            if (!stream_can_fastseek)
+                trust_demux_pos = true;
+        }
+    }
+
+    if (!trust_demux_pos && source->point.length != VLC_TICK_INVALID && !source->point.live)
         source->point.position = (ts - player->timer.input_normal_time - player->timer.start_offset)
                                / (double) source->point.length;
     else
--
2.39.1

