From 4a8aef97ccf0f39ca57eb687414f4c1e2346dc4b Mon Sep 17 00:00:00 2001
From: ci7lus <7887955+ci7lus@users.noreply.github.com>
Date: Sun, 15 Feb 2026 03:40:46 +0900
Subject: [PATCH 2/2] demux/mpeg: Mapping ES program nowPlaying to metadata
 title

---
 modules/demux/mpeg/ts_si.c |  4 +++
 src/input/es_out.c         | 53 +++++++++++++++++++++++++++++++++++---
 2 files changed, 53 insertions(+), 4 deletions(-)

diff --git a/modules/demux/mpeg/ts_si.c b/modules/demux/mpeg/ts_si.c
index 4f31fc7fe1..2d1f2e0310 100644
--- a/modules/demux/mpeg/ts_si.c
+++ b/modules/demux/mpeg/ts_si.c
@@ -281,6 +281,10 @@ static void SDTCallBack( void *opaque, dvbpsi_sdt_t *p_sdt )
                     if( pD->i_service_type >= 0x01 && pD->i_service_type <= 0x10 )
                         psz_type = ppsz_type[pD->i_service_type];
                 }
+                if (p_sys->standard == TS_STANDARD_ARIB)
+                {
+                    vlc_meta_SetPublisher( p_meta, str2 ? str2 : str1 );
+                }
                 free( str1 );
                 free( str2 );
             }
diff --git a/src/input/es_out.c b/src/input/es_out.c
index d341adac71..32d2492c5d 100644
--- a/src/input/es_out.c
+++ b/src/input/es_out.c
@@ -1639,12 +1639,30 @@ static void EsOutProgramSelect(es_out_sys_t *p_sys, es_out_pgrm_t *p_pgrm)
     /* Update now playing */
     if( p_pgrm->p_meta )
     {
-        input_item_SetESNowPlaying( input_priv(p_input)->p_item,
-                                    vlc_meta_Get( p_pgrm->p_meta, vlc_meta_ESNowPlaying ) );
+        /* We set ESNowPlaying (which is Program Name from EIT) as the input Item's Title */
+        const char *psz_nowplaying = vlc_meta_Get( p_pgrm->p_meta, vlc_meta_ESNowPlaying );
+
+        /* Note: input_item_SetESNowPlaying updates the "Now Playing" meta used by VLC internally.
+           The user requested to keep "NowPlaying" as is (or as handled by VLC), so we keep this call.
+           However, we explicitly map ESNowPlaying to Title as requested. */
+        input_item_SetESNowPlaying( input_priv(p_input)->p_item, psz_nowplaying );
+
         input_item_SetPublisher( input_priv(p_input)->p_item,
                                  vlc_meta_Get( p_pgrm->p_meta, vlc_meta_Publisher ) );
-        input_item_SetTitle( input_priv(p_input)->p_item,
-                             vlc_meta_Get( p_pgrm->p_meta, vlc_meta_Title ) );
+
+        if( psz_nowplaying )
+        {
+             msg_Dbg( p_input, "EsOutProgramSelect: Setting Title to %s from ESNowPlaying", psz_nowplaying );
+             input_item_SetTitle( input_priv(p_input)->p_item, psz_nowplaying );
+        }
+        else
+        {
+             const char *psz_title = vlc_meta_Get( p_pgrm->p_meta, vlc_meta_Title );
+             msg_Dbg( p_input, "EsOutProgramSelect: ESNowPlaying is NULL, using Title: %s", psz_title ? psz_title : "NULL" );
+             input_item_SetTitle( input_priv(p_input)->p_item, psz_title );
+        }
+
+        EsOutMeta( p_sys, NULL, p_pgrm->p_meta );
         input_SendEventMeta( p_input );
         /* FIXME: we probably want to replace every input meta */
     }
@@ -2039,6 +2057,15 @@ static void EsOutProgramEpg(es_out_sys_t *p_sys, input_source_t *source,
                                      vlc_meta_Get( p_pgrm->p_meta, vlc_meta_ESNowPlaying ) : NULL;

         input_item_SetESNowPlaying( input_priv(p_input)->p_item, psz_nowplaying );
+        if( psz_nowplaying )
+        {
+            msg_Dbg( p_input, "EsOutProgramEpg: Setting Title to %s from ESNowPlaying", psz_nowplaying );
+            input_item_SetMeta( input_priv(p_input)->p_item, vlc_meta_Title, psz_nowplaying );
+        }
+        else
+        {
+            msg_Dbg( p_input, "EsOutProgramEpg: ESNowPlaying is NULL, not setting Title" );
+        }
         input_SendEventMeta( p_input );

         const char *now_playing_tr =
@@ -2105,6 +2132,24 @@ static void EsOutMeta(es_out_sys_t *p_sys, const vlc_meta_t *p_meta, const vlc_m
     vlc_mutex_lock( &p_item->lock );
     if( p_meta )
         vlc_meta_Merge( p_item->p_meta, p_meta );
+
+    if( p_program_meta )
+    {
+        const char *psz_nowplaying = vlc_meta_Get( p_program_meta, vlc_meta_ESNowPlaying );
+        if( psz_nowplaying )
+        {
+            msg_Dbg( p_input, "EsOutMeta: Setting Title to %s from ESNowPlaying", psz_nowplaying );
+            vlc_meta_SetTitle( p_item->p_meta, psz_nowplaying );
+        }
+        else
+        {
+            msg_Dbg( p_input, "EsOutMeta: ESNowPlaying is NULL in p_program_meta, not setting Title" );
+        }
+    }
+    else
+    {
+        msg_Dbg( p_input, "EsOutMeta: p_program_meta is NULL, ignoring" );
+    }
     vlc_mutex_unlock( &p_item->lock );

     /* Check program meta to not override GROUP_META values */
--
2.39.1

