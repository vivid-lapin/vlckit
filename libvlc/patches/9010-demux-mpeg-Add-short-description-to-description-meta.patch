From 6f2b6880a6dfec81df1fb8a20cd8edfe762521c5 Mon Sep 17 00:00:00 2001
From: ci7lus <7887955+ci7lus@users.noreply.github.com>
Date: Sun, 15 Feb 2026 03:49:09 +0900
Subject: [PATCH] demux/mpeg: Add short description to description metadata

---
 modules/demux/mpeg/ts_si.c | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/modules/demux/mpeg/ts_si.c b/modules/demux/mpeg/ts_si.c
index 2d1f2e0310..a79f449c4e 100644
--- a/modules/demux/mpeg/ts_si.c
+++ b/modules/demux/mpeg/ts_si.c
@@ -694,6 +694,7 @@ static void EITCallBack( void *opaque, dvbpsi_eit_t *p_eit )
 
     if( p_epg->i_event > 0 )
     {
+        p_epg->b_present = (p_eit->i_table_id == 0x4e);
         if( p_epg->b_present && p_epg->p_current )
         {
             ts_pat_t *p_pat = ts_pid_Get(&p_sys->pids, 0)->u.p_pat;
@@ -703,8 +704,20 @@ static void EITCallBack( void *opaque, dvbpsi_eit_t *p_eit )
                 p_pmt->eit.i_event_start = p_epg->p_current->i_start;
                 p_pmt->eit.i_event_length = p_epg->p_current->i_duration;
             }
+
+            vlc_meta_t *p_meta = vlc_meta_New();
+            if( p_meta )
+            {
+                if( p_epg->p_current->psz_name )
+                    vlc_meta_SetTitle( p_meta, p_epg->p_current->psz_name );
+                if( p_epg->p_current->psz_short_description )
+                    vlc_meta_SetDescription( p_meta, p_epg->p_current->psz_short_description );
+
+                es_out_Control( p_demux->out, ES_OUT_SET_GROUP_META,
+                                p_eit->i_extension, p_meta );
+                vlc_meta_Delete( p_meta );
+            }
         }
-        p_epg->b_present = (p_eit->i_table_id == 0x4e);
         es_out_Control( p_demux->out, ES_OUT_SET_GROUP_EPG, p_eit->i_extension, p_epg );
     }
     vlc_epg_Delete( p_epg );
-- 
2.39.1

