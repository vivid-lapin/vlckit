From 568eff1d3d1a6edeb2c9bbde0d69c151a02b297f Mon Sep 17 00:00:00 2001
From: ci7lus <7887955+ci7lus@users.noreply.github.com>
Date: Tue, 3 Feb 2026 00:39:08 +0900
Subject: [PATCH] demux/mpeg: Print logs

---
 extras/tools/packages.mak | 2 +-
 modules/demux/mpeg/ts.c   | 7 +++++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/extras/tools/packages.mak b/extras/tools/packages.mak
index e48be5d5f5..cdf045042a 100644
--- a/extras/tools/packages.mak
+++ b/extras/tools/packages.mak
@@ -1,4 +1,4 @@
-GNU=https://ftpmirror.gnu.org/gnu
+GNU=https://ftp.gnu.org/gnu
 APACHE=https://downloads.apache.org/
 SF=https://downloads.sourceforge.net/project
 VIDEOLAN=https://downloads.videolan.org/pub/contrib
diff --git a/modules/demux/mpeg/ts.c b/modules/demux/mpeg/ts.c
index ac098e8c0c..48e6a9bd48 100644
--- a/modules/demux/mpeg/ts.c
+++ b/modules/demux/mpeg/ts.c
@@ -935,11 +935,13 @@ static int Control( demux_t *p_demux, int i_query, va_list args )
             if( !EITCurrentEventTime( p_pmt, p_sys, &i_time, &i_length ) && i_length > 0 )
             {
                 *pf = (double)i_time/(double)i_length;
+                msg_Dbg( p_demux, "DEMUX_GET_POSITION: using EIT-based position: %f", *pf );
                 return VLC_SUCCESS;
             }
         }

         if( !p_sys->b_ignore_time_for_positions &&
+             p_sys->b_canfastseek &&
              p_pmt &&
              p_pmt->pcr.i_first != VLC_TICK_INVALID &&
              p_pmt->i_last_dts != VLC_TICK_INVALID &&
@@ -951,6 +953,7 @@ static int Control( demux_t *p_demux, int i_query, va_list args )
             if( i_length > 0 )
             {
                 *pf = i_pos / i_length;
+                msg_Dbg( p_demux, "DEMUX_GET_POSITION: using PCR/DTS-based position: %f", *pf );
                 return VLC_SUCCESS;
             }
         }
@@ -959,6 +962,7 @@ static int Control( demux_t *p_demux, int i_query, va_list args )
         {
             uint64_t offset = vlc_stream_Tell( p_sys->stream );
             *pf = (double)offset / (double)u64;
+            msg_Dbg( p_demux, "DEMUX_GET_POSITION: using byte-based position (offset:%"PRIu64", size:%"PRIu64"): %f", offset, u64, *pf );
             return VLC_SUCCESS;
         }
         break;
@@ -1051,6 +1055,7 @@ static int Control( demux_t *p_demux, int i_query, va_list args )
             time_t i_event_start;
             if( !EITCurrentEventTime( p_pmt, p_sys, &i_event_start, NULL ) )
             {
+                msg_Dbg( p_demux, "DEMUX_GET_TIME: using EIT-based time" );
                 *va_arg( args, vlc_tick_t * ) = vlc_tick_from_sec( i_event_start );
                 return VLC_SUCCESS;
             }
@@ -1058,6 +1063,7 @@ static int Control( demux_t *p_demux, int i_query, va_list args )

         if( p_pmt && p_pmt->pcr.i_current != VLC_TICK_INVALID && p_pmt->pcr.i_first != VLC_TICK_INVALID )
         {
+            msg_Dbg( p_demux, "DEMUX_GET_TIME: using PCR-based time (current:%"PRId64", first:%"PRId64")", p_pmt->pcr.i_current, p_pmt->pcr.i_first );
             *va_arg( args, vlc_tick_t * ) = p_pmt->pcr.i_current - p_pmt->pcr.i_first;
             return VLC_SUCCESS;
         }
@@ -1095,6 +1101,7 @@ static int Control( demux_t *p_demux, int i_query, va_list args )
                 msg_Warn( p_demux, "Can't get stream duration. Edited ?" );
                 return VLC_EGENERIC;
             }
+            msg_Dbg( p_demux, "DEMUX_GET_LENGTH: %"PRId64" (last:%"PRId64", start:%"PRId64")", i_last - i_start, i_last, i_start );
             *va_arg( args, vlc_tick_t * ) = i_last - i_start;
             return VLC_SUCCESS;
         }
--
2.39.1

